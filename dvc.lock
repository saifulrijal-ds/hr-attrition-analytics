schema: '2.0'
stages:
  generate_data:
    cmd: python src/stages/data_generation.py
    deps:
    - path: src/data/data_generator.py
      hash: md5
      md5: 7392d0190984d983f726d622520eeb44
      size: 69305
    - path: src/stages/data_generation.py
      hash: md5
      md5: d122c69bb80dbe05524a94619a0fb62c
      size: 2323
    params:
      params.yaml:
        attrition_scenarios:
          normal:
            rate: 0.5
            description: Normal market conditions
            is_active: false
          low_stress:
            rate: 0.35
            description: Low competition, high retention period
            is_active: true
          high_stress:
            rate: 0.65
            description: High competition or restructuring period
            is_active: false
        company:
          name: BFI Finance Indonesia
          num_employees: 4000
          historical_years: 5
          random_seed: 42
    outs:
    - path: data/stages/raw/employees.csv
      hash: md5
      md5: b0a3b5d0dd209d9d0747086a28c80ec9
      size: 1148910
    - path: data/stages/raw/exit_interviews.csv
      hash: md5
      md5: 0a80fe37567a01224ac31846fd361b2f
      size: 436978
    - path: data/stages/raw/metadata.yaml
      hash: md5
      md5: 5f358bf535a759163cf98836a83248a8
      size: 250
    - path: data/stages/raw/performance.csv
      hash: md5
      md5: acc213f0c732d978fccfee06462d2661
      size: 2759756
    - path: data/stages/raw/promotions.csv
      hash: md5
      md5: 03773348098a78b9016a1d723a204228
      size: 651809
    - path: data/stages/raw/recruitment_costs.csv
      hash: md5
      md5: 45fd38d52d0e4f027f99f138c3d3547b
      size: 982
    - path: data/stages/raw/surveys.csv
      hash: md5
      md5: ced24b1fb8e2d6badd55bcb345976580
      size: 5913189
    - path: data/stages/raw/training.csv
      hash: md5
      md5: 253eb0fda17e13767dd033c8b4b02d13
      size: 3394373
  preprocess:
    cmd: python src/stages/data_preprocessing.py
    deps:
    - path: data/stages/raw/employees.csv
      hash: md5
      md5: b0a3b5d0dd209d9d0747086a28c80ec9
      size: 1148910
    - path: src/stages/data_preprocessing.py
      hash: md5
      md5: f866dcc0b0087d197e896f4bdb25c64e
      size: 4738
    params:
      params.yaml:
        split:
          method: hire_date
          train_end_date: '2023-12-31'
          test_start_date: '2024-01-01'
    outs:
    - path: data/stages/preprocessed/split_metadata.yaml
      hash: md5
      md5: 17a2169d5bb8b7c2c364b4bbc06d66f9
      size: 203
    - path: data/stages/preprocessed/test_data.csv
      hash: md5
      md5: b7e66d52d899dbc67d3486ca0b4aa87d
      size: 277686
    - path: data/stages/preprocessed/train_data.csv
      hash: md5
      md5: c6c728aa09f116a5474330aaa687ad2d
      size: 861797
  train:
    cmd: python src/stages/model_training.py
    deps:
    - path: data/stages/preprocessed/train_data.csv
      hash: md5
      md5: c6c728aa09f116a5474330aaa687ad2d
      size: 861797
    - path: src/stages/model_training.py
      hash: md5
      md5: 8f57d8e7c0d40ae7f0fd7f0121471fc8
      size: 16464
    params:
      params.yaml:
        features:
          categorical_encoding: one-hot
          standardize_numeric: true
          include_interaction_terms: false
          add_performance_categories: false
        mlflow:
          dagshub_repo_name: hr-attrition-analytics
          dagshub_repo_owner: saifulrijal873
        model:
          type: lightgbm_sklearn
          n_estimators: 500
          num_leaves: 31
          learning_rate: 0.05
          feature_fraction: 0.9
          bagging_fraction: 0.8
          bagging_freq: 5
          class_weight: balanced
          max_depth: 7
          min_child_samples: 20
          reg_alpha: 0.1
          reg_lambda: 0.1
          boosting_type: gbdt
          objective: binary
          metric: auc
          n_jobs: -1
    outs:
    - path: data/stages/features/feature_importance.csv
      hash: md5
      md5: ec8fba924c150950e273e6e040dc251d
      size: 1491
    - path: metrics/training_metrics.json
      hash: md5
      md5: f5914bb60854af60708c572d8fc740f4
      size: 561
    - path: models/attrition_model.joblib
      hash: md5
      md5: 400cea5dc1c201cc2356f1be77dacb04
      size: 1626767
  evaluate:
    cmd: python src/stages/model_evaluation.py
    deps:
    - path: data/stages/preprocessed/test_data.csv
      hash: md5
      md5: b7e66d52d899dbc67d3486ca0b4aa87d
      size: 277686
    - path: models/attrition_model.joblib
      hash: md5
      md5: 400cea5dc1c201cc2356f1be77dacb04
      size: 1626767
    - path: src/stages/model_evaluation.py
      hash: md5
      md5: ef63d15670678d0f84855981c62c743b
      size: 14961
    outs:
    - path: metrics/age_risk.csv
      hash: md5
      md5: 0ee5a2241cd0a32ad0b6f195e5238d53
      size: 129
    - path: metrics/classification_report.csv
      hash: md5
      md5: abf023cd3933e22f4e4df0f32969119c
      size: 401
    - path: metrics/department_risk.csv
      hash: md5
      md5: 395814660436df2cf06fac420df6fb11
      size: 319
    - path: metrics/evaluation_metrics.json
      hash: md5
      md5: 1cc82d32b58cb8ef45e5df33a13184d0
      size: 567
    - path: metrics/joblevel_risk.csv
      hash: md5
      md5: 5a2a0b777b278b0f1b143adf8292a1ce
      size: 230
    - path: metrics/threshold_analysis.csv
      hash: md5
      md5: e4feaabc2dd3036ea10306793deb6ec1
      size: 832
    - path: reports/figures/age_risk.png
      hash: md5
      md5: 4e19aeba60892bc674a6dd441614f4a7
      size: 95709
    - path: reports/figures/confusion_matrix.png
      hash: md5
      md5: d264b579daa7aed8f68f1f0e8b795536
      size: 84160
    - path: reports/figures/department_risk.png
      hash: md5
      md5: 595d991e1f4793dcb732ce4aafd423e2
      size: 164832
    - path: reports/figures/joblevel_risk.png
      hash: md5
      md5: 4f9e8f8ee98a6f88796ba7a0fdede692
      size: 91574
    - path: reports/figures/precision_recall_curve.png
      hash: md5
      md5: 11a18a5069ded4508cd4b68c031df44b
      size: 105882
    - path: reports/figures/roc_curve.png
      hash: md5
      md5: e9b629c6c8c791785b87532cce849415
      size: 144097
    - path: reports/figures/threshold_impact.png
      hash: md5
      md5: c50fbe3f3245109189f262f3c8d36428
      size: 168524
